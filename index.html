<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="nav">
      <h3>Train Ticket Reservation</h3>
    </div>
    <div class="container">
      <!-- <h1>Train Ticket Booking</h1> -->
      <div class="input-form">
        <label for="">Enter the No. Of Seats</label>
        <input type="number" id="total_seats" />
        <button onclick="reserveSeats()">Book Now</button>
        <button onclick="resetSeats()">Reset Seats</button>
      </div>
      <div class="coach">
        <div class="row">
          <div class="seat available" id="seat-1">1</div>
          <div class="seat available" id="seat-2">2</div>
          <div class="seat available" id="seat-3">3</div>
          <div class="seat available" id="seat-4">4</div>
          <div class="seat available" id="seat-5">5</div>
          <div class="seat available" id="seat-6">6</div>
          <div class="seat available" id="seat-7">7</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-8">8</div>
          <div class="seat available" id="seat-9">9</div>
          <div class="seat available" id="seat-10">10</div>
          <div class="seat available" id="seat-11">11</div>
          <div class="seat available" id="seat-12">12</div>
          <div class="seat available" id="seat-13">13</div>
          <div class="seat available" id="seat-14">14</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-15">15</div>
          <div class="seat available" id="seat-16">16</div>
          <div class="seat available" id="seat-17">17</div>
          <div class="seat available" id="seat-18">18</div>
          <div class="seat available" id="seat-19">19</div>
          <div class="seat available" id="seat-20">20</div>
          <div class="seat available" id="seat-21">21</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-22">22</div>
          <div class="seat available" id="seat-23">23</div>
          <div class="seat available" id="seat-24">24</div>
          <div class="seat available" id="seat-25">25</div>
          <div class="seat available" id="seat-26">26</div>
          <div class="seat available" id="seat-27">27</div>
          <div class="seat available" id="seat-28">28</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-29">29</div>
          <div class="seat available" id="seat-30">30</div>
          <div class="seat available" id="seat-31">31</div>
          <div class="seat available" id="seat-32">32</div>
          <div class="seat available" id="seat-33">33</div>
          <div class="seat available" id="seat-34">34</div>
          <div class="seat available" id="seat-35">35</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-36">36</div>
          <div class="seat available" id="seat-37">37</div>
          <div class="seat available" id="seat-38">38</div>
          <div class="seat available" id="seat-39">39</div>
          <div class="seat available" id="seat-40">40</div>
          <div class="seat available" id="seat-41">41</div>
          <div class="seat available" id="seat-42">42</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-43">43</div>
          <div class="seat available" id="seat-44">44</div>
          <div class="seat available" id="seat-45">45</div>
          <div class="seat available" id="seat-46">46</div>
          <div class="seat available" id="seat-47">47</div>
          <div class="seat available" id="seat-48">48</div>
          <div class="seat available" id="seat-49">49</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-50">50</div>
          <div class="seat available" id="seat-51">51</div>
          <div class="seat available" id="seat-52">52</div>
          <div class="seat available" id="seat-53">53</div>
          <div class="seat available" id="seat-54">54</div>
          <div class="seat available" id="seat-55">55</div>
          <div class="seat available" id="seat-56">56</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-57">57</div>
          <div class="seat available" id="seat-58">58</div>
          <div class="seat available" id="seat-59">59</div>
          <div class="seat available" id="seat-60">60</div>
          <div class="seat available" id="seat-61">61</div>
          <div class="seat available" id="seat-62">62</div>
          <div class="seat available" id="seat-63">63</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-64">64</div>
          <div class="seat available" id="seat-65">65</div>
          <div class="seat available" id="seat-66">66</div>
          <div class="seat available" id="seat-67">67</div>
          <div class="seat available" id="seat-68">68</div>
          <div class="seat available" id="seat-69">69</div>
          <div class="seat available" id="seat-70">70</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-71">71</div>
          <div class="seat available" id="seat-72">72</div>
          <div class="seat available" id="seat-73">73</div>
          <div class="seat available" id="seat-74">74</div>
          <div class="seat available" id="seat-75">75</div>
          <div class="seat available" id="seat-76">76</div>
          <div class="seat available" id="seat-77">77</div>
        </div>
        <div class="row">
          <div class="seat available" id="seat-78">78</div>
          <div class="seat available" id="seat-79">79</div>
          <div class="seat available" id="seat-80">80</div>
        </div>
        <!-- and so on until the last row -->
      </div>
      <div class="sign">
        <div class="seat booked"></div>
        <h4>Booked</h4>
        <div class="seat available"></div>
        <h4>Available</h4>
      </div>
    </div>

    <script>
      const displaySeats = async () => {
        const res = await fetch("http://localhost:8081/allSeats");
        const data = await res.json();
        if (data) {
          for (let i = 0; i < data.length; ++i) {
            const seat = data[i];
            const div = document.getElementById(`seat-${seat.seatNumber}`);
            if (seat.status === "booked") {
              div.classList.remove("available");
              div.classList.add("booked");
            }
          }
        }
      };
      displaySeats();
      // Make a POST request to reserve the seats
      const reserveSeats = async () => {
        const numSeats = parseInt(document.getElementById("total_seats").value);
        if (numSeats <= 7) {
          const response = await fetch("http://localhost:8081/reserve", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ numSeats }),
          });
          const result = await response.json();
          // console.log(result);
          if (result.success) {
            alert(`Your Seats ${result.seats} is Booked`);
            displaySeats();
          } else {
            alert(result.message);
          }
        } else {
          alert("Enter the no of seats less than or equal to 7");
        }
      };

      const resetSeats = async () => {
        const res = await fetch("http://localhost:8081/reset", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        });
        const result = await res.json();
        if (result.success) {
          alert("All seats are reset to available")
          window.location.reload()
        } else {
          alert(result.message);
        }
      };
    </script>
  </body>
</html>
